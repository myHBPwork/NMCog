!function(t){var e=t.components.dependencies._,i=t.components.dependencies.Modernizr,s=t.components.dependencies.jQuery.v1_11,n=!!i.touch,o={component:t.paths.join("/Global/UxPlugins/ixp-flow/js/",t.flags.debug?"/hammer-2.0.4.js":"/hammer-2.0.4.min.js"),cdn:t.paths.getCdnPath("/libs/hammer.js/2.0.4/hammer.min.js")};t.dependencies.define("hammer",{url:o.cdn,getInstanceExport:function(){return window.Hammer},getInstanceVersion:function(t){return Hammer.VERSION}});var a=function(e){t.dependencies.require("hammer").then(function(t){e(t)})},r=t.components.constants.merge({flowSelector:".ixp-component-flow["+t.components.constants.components.data.componentRoot+"]",initClass:"ixp-component-flow-init",modes:{modeAttr:"data-ixp-flow-mode",normalMode:"normal",editMode:"edit"},steps:{previousStep:"ixp-component-flow-prev",activeStepOut:"ixp-component-flow-out ixp-flow-prev",activeStepIn:"ixp-component-flow-in ixp-flow-active",activeStep:"ixp-component-flow-active",attrPlacement:"data-ixp-flow-step-placement",attrTransitioning:"data-ixp-flow-step-transitioning"},progress:{wrapperSelector:".ixp-component-flow-progress",doneStep:"ixp-component-flow-progress-done",activeStep:"ixp-component-flow-progress-active",clickable:"ixp-component-flow-progress-clickable",progressInit:"ixp-component-flow-progress-init"},templates:{badgeUi:'<div class="pe-element-badge-pager"><span data-ixp-flow-action="prevStep" class="pe-element-badge-pager-prev"></span><span data-ixp-flow-action="nextStep" class="pe-element-badge-pager-next"></span></div>',progressBar:'<div class="ixp-component-flow-progress ixp-component-flow-progress-%%style%%" data-ixp-progress-bar="%%ID%%"><div class="ixp-component-flow-progress-inner"></div></div>',progressItem:'<div class="ixp-component-flow-progress-toggle" data-ixp-action-toggle="%%ID%%" data-step="%%iter%%" %%TOOLTIP%%>%%label%%</div>',nextButton:'<div class="ixp-component-flow-control-next" data-ixp-action-next="%%ID%%"></div>',previousButton:'<div class="ixp-component-flow-control-back" data-ixp-action-previous="%%ID%%"></div>'},regex:{style:new RegExp("%%style%%","g"),id:new RegExp("%%ID%%","g"),iter:new RegExp("%%iter%%","g"),label:new RegExp("%%label%%","g"),tooltip:new RegExp("%%TOOLTIP%%","g")},behaviors:{nextStep:"flow-next",previousStep:"flow-back",firstStep:"flow-first",lastStep:"flow-last",transitions:{allSteps:{classSlideVertical:"ixp-component-flow-vertical-all",classSlideHorizontal:"ixp-component-flow-horizontal-all",classFade:"ixp-component-flow-fade-all",allClasses:"ixp-component-flow-vertical-all ixp-component-flow-horizontal-all ixp-component-flow-fade-all"},step:{classSlideVertical:"ixp-component-flow-vertical",classSlideHorizontal:"ixp-component-flow-horizontal",classFade:"ixp-component-flow-fade",allClasses:"ixp-component-flow-vertical ixp-component-flow-horizontal ixp-component-flow-fade"},duration:500,easing:"linear"}},step:{events:{resized:":flowstep:resize"}},extensibility:{commands:{navigate:":navigate",scrollto:":scrollto"},events:{navigating:":navigating",navigated:":navigated"}}});t.components.registerExtensibility("ixp-flow",{commands:r.extensibility.commands||{},events:r.extensibility.events||{}});var l={updateProgress:function(t,e,i,s){var n=function(){return s.children("[data-ixp-progress-bar]")},o=n();if(e<1||"none"===t)return void(o.length&&o.remove());if(s.removeClass("ixp-component-flow-progress-off"),s.addClass("ixp-component-flow-progress-on"),o.length)o.children().children().remove();else{var a=r.templates.progressBar;a=a.replace(r.regex.style,t),a=a.replace(r.regex.id,i),s.append(a),o=n()}for(var l=s.children(".ixp-component-flow-steps").children(),p=[],c=0;c<e;c++){var h=l.eq(c),d=h&&h.attr("data-ixp-component-flow-step-tooltip")||"";""!==d&&(d='data-ixp-c-flow-tooltip="'+d+'"');var f=r.templates.progressItem;f=f.replace(r.regex.iter,c),f=f.replace(r.regex.label,c+1),f=f.replace(r.regex.id,i),f=f.replace(r.regex.tooltip,d),p.push(f)}o.children().first().html(p.join("")),"clickable"===t?o.addClass(r.progress.clickable):o.removeClass(r.progress.clickable),o.addClass(r.progress.progressInit)},updateControls:function(t,e,i){if(!t)return void i.children(".ixp-component-flow-control-back, .ixp-component-flow-control-next").remove();if(!i.children(".ixp-component-flow-control-back, .ixp-component-flow-control-next").length){var s="",n=r.templates.nextButton;n=n.replace(r.regex.id,e),s+=n,n=r.templates.previousButton,n=n.replace(r.regex.id,e),s+=n,i.append(s)}},getFlowScaffolding:function(t,e,i){for(var s=e.scaffoldContainer("Flow"),n=[],o=1;o<4;o++){var a=e.scaffold("ixp-flow-step","Flow Step");n.push(a)}return s.content.scaffolding=n,{scaffolding:[s],style:{customClass:e.getDefaultThemes({flow:"","flow-progress":"ixp-component-flow-default","flow-progress-align-horizontal":"","flow-progress-align-vertical":"","flow-transition":""})}}},getStepScaffolding:function(t,e,i){var s=e.scaffoldContainer("Flow Step");return{scaffolding:[s],style:{customClass:e.getDefaultThemes({flowstep:"","flowstep-transition":""})}}}};t.components.register("ixp-flow",{initialize:function(i){this.transitionEndEventName="webkitTransitionEnd"+this.eventNamespace+" otransitionend"+this.eventNamespace+" msTransitionEnd"+this.eventNamespace+" transitionend"+this.eventNamespace,this.progressSelector='[data-ixp-action-toggle="'+this.instanceId+'"]',this.previousSelector='[data-ixp-action-previous="'+this.instanceId+'"]',this.nextSelector='[data-ixp-action-next="'+this.instanceId+'"]',this.stepDelegateSelector='[data-ixp-flow-steps="'+this.instanceId+'"] > .ixp-component-flow-step',this.seq=0,this.looping_enabled&&this.$el.removeClass("ixp-component-flow-no-looping"),this._updateSteps(),this._updateProgress(),this._updateControls(),this.debouncedCleanSteps=e.debounce(e.bind(this._cleanSteps,this),50,{maxWait:100}),this.$el.on(this.transitionEndEventName,this.stepDelegateSelector,e.bind(this._onTransitionEnd,this)),this.activeHeight=this.inStudio?this.stepsWrap.outerHeight():0,this.show({step:this.seq}),this.debouncedShow=e.debounce(this.show,250,{leading:!0,trailing:!1}),t.events.on(this,this.instanceId+r.step.events.resized,e.debounce(e.bind(this._onResize,this),10,{maxWait:20})),this.inStudio||(this.onBehavior(this.$el,r.behaviors.nextStep,this._onBehaviorGotoNext),this.onBehavior(this.$el,r.behaviors.previousStep,this._onBehaviorGotoPrevious),this.onBehavior(this.$el,r.behaviors.firstStep,this._onBehaviorGotoFirst),this.onBehavior(this.$el,r.behaviors.lastStep,this._onBehaviorGotoLast))},onDocumentReady:function(){if(this._onResize(),this.recalculateVisibility({delay:1}),!this.inStudio){if(n&&this.navigation_enabled){var t=this;a(function(e){if(!t.hammerInstance){var i=t.$el.find('[data-ixp-flow-steps="'+t.instanceId+'"]');t.hammerInstance=new e(i[0])}t.hammerInstance.off("swipe"),t.hammerInstance.on("swipe",function(i){i.preventDefault();var s={isClicked:!0,loop:t.looping_enabled};i.direction===e.DIRECTION_RIGHT||i.direction===e.DIRECTION_DOWN?t.previous(s):t.next(s)})})}this.autoplay_enabled&&this.startAuto()}return!0},stopAuto:function(){this.autoTimer&&(clearInterval(this.autoTimer),delete this.autoTimer)},startAuto:function(){if(this.stopAuto(),!this.inStudio){if(!this.autoPlayDuration){var t=4e3;if(this.autoplay_delay){var e=parseInt(this.autoplay_delay,10);isNaN(e)||(t=Math.abs(1e3*e))}this.autoPlayDuration=t}var i=this;this.autoTimer=setInterval(function(){i.next({loop:i.looping_enabled})},this.autoPlayDuration)}},show:function(t){t=e.extend({step:0,stepCount:this.maxseq},t||{}),t.isClicked&&t.isClicked===!0&&(this.autoplay_enabled&&!this.autoplay_stop_on_navigation&&(this.autoplayPaused=!0),this.stopAuto());var s=this.seq,n=t.stepCount,o=t.step,a=!1;if(o>=n?t.loop===!0?(o=0,a=!0):o=n-1:o<0&&(t.loop===!0?(o=n-1,a=!0):o=0),t.force||!this.showInit||s!==o){var l=this._getSteps(),p=l.filter(":eq("+s+")"),c=l.filter(":eq("+o+")"),h={steps:n,step:{index:s,element:p[0]},targetStep:{index:o,element:c[0]},cancel:!1};if(this.triggerExtensibility(r.extensibility.events.navigating,h),o=h.targetStep&&h.targetStep.index,!(h.cancel||o>=n||o<0||!t.force&&this.showInit&&o===s)){var d=!1;(!this.showInit||a&0===o||!a&&o>s)&&(d=!0);var f=d?"forward":"backward",u=0===o?"start":o===n-1?"end":"middle",g=this.$el.find(this.progressSelector),v=g.filter(":eq("+o+")");g.removeClass(r.progress.activeStep+" "+r.progress.doneStep),v.prevAll().addClass(r.progress.doneStep),v.addClass(r.progress.activeStep),this.$el.attr("data-ixp-flow-direction",f),this.$el.attr("data-ixp-flow-progress",u);var m=this;if(i&&i.csstransitions!==!0?this.showInit?(p.attr(r.steps.attrTransitioning,"leave"),c.attr(r.steps.attrTransitioning,"enter"),this.activeStep=c,this._doTransitions(d,c,p)):(c.siblings().attr(r.steps.attrPlacement,"out").hide(),c.attr(r.steps.attrPlacement,"in").css({left:0,top:0}).show(),this.activeStep=c):this.showInit?setTimeout(function(){p.attr(r.steps.attrTransitioning,"leave"),c.attr(r.steps.attrTransitioning,"enter"),m.activeStep=c,m.$el.is(":hidden")&&setTimeout(function(){m._cleanSteps()},1)},1):(c.siblings().attr(r.steps.attrPlacement,"out"),c.attr(r.steps.attrPlacement,"in"),this.activeStep=c),this.seq=o,this._onResize(),t.isClicked&&t.isClicked===!0&&window.liveballTag){var x=c.data("ixp-component-tag");""!==x&&liveballTag(x)}this.showInit||(this.$el.removeClass(r.initClass),this.showInit=!0)}}},_getTransition:function(t){var e=function(t,e){return t.hasClass(e.classSlideVertical)?"slideY":t.hasClass(e.classSlideHorizontal)?"slideX":t.hasClass(e.classFade)?"fade":null},i=e(t,r.behaviors.transitions.step);if(!i){var s=this.$el;i=e(s,r.behaviors.transitions.allSteps)}return i},_doTransitions:function(t,e,i){var s=this._getTransition(e),n=this._getTransition(i);if("slideX"===s||"slideY"===s){var o=this;e.show(0,function(){o._doTransition(i,n,t,!1),o._doTransition(e,s,t,!0)})}else this._doTransition(i,n,t,!1),this._doTransition(e,s,t,!0)},_doTransition:function(t,e,i,s){s||s===!1||(s=!1);var n=this;if("fade"===e){var o=s?1:0;t.fadeTo(r.behaviors.transitions.duration,o,r.behaviors.transitions.easing,function(){s&&n._cleanSteps()})}else if("slideX"===e||"slideY"===e){var a,l;"slideX"===e?(a="left",l=this.stepsWrap.outerWidth()+"px"):(a="top",l=this.stepsWrap.outerHeight()+"px");var p=i?"-=":"+=",c={};c[a]=p+l,t.animate(c,{duration:r.behaviors.transitions.duration,queue:!1,complete:function(){s&&n._cleanSteps()}})}else t.toggle(s),s&&this._cleanSteps()},previous:function(t){t=e.extend(t||{},{step:this.seq-1}),this.debouncedShow(t)},next:function(t){t=e.extend(t||{},{step:this.seq+1}),this.debouncedShow(t)},_onResize:function(t){this.inStudio&&this.activeHeight===this._getActiveHeight()||this._updateHeight()},_onTransitionEnd:function(t){this._isOwnStep(s(t.target))&&this.debouncedCleanSteps()},_cleanSteps:function(){var e=this._getSteps();this.activeStep.attr(r.steps.attrPlacement,"in"),e.removeAttr(r.steps.attrTransitioning),this.activeStep.siblings().attr(r.steps.attrPlacement,"out");var i=!this.inStudio&&this.change_scroll_top;i&&this.scrollToDeferred&&this.scrollToDeferred.preventScrollToStep&&(i=!1),i&&t.scrollTo(this.activeStep,{speed:r.behaviors.transitions.duration/2,inViewport:{tolerance:1,edge:"top"},updateUrlHash:!1}),this.recalculateVisibility({delay:1});var s={steps:this.maxseq,step:{index:this.seq,element:e.filter(":eq("+this.seq+")")[0]}};this.triggerExtensibility(r.extensibility.events.navigated,s),this._resolveScrollTo("completed"),this.autoplayPaused&&(this.autoplayPaused=!1,this.startAuto())},_onProgressClick:function(t){t.preventDefault();var e=t.target;this.show({step:this.$(e).data("step"),isClicked:!0})},_onClickGotoNext:function(t){t.preventDefault(),this.next({isClicked:!0,loop:this.looping_enabled})},_onClickGotoPrevious:function(t){t.preventDefault(),this.previous({isClicked:!0,loop:this.looping_enabled})},_onBehaviorGotoNext:function(t){t.preventDefault();var e=this.maxseq,i=this.seq;if(i<e){if(t.originalEvent&&t.originalEvent[r.inputs.events.handled+this.instanceId])return;t.originalEvent[r.inputs.events.handled+this.instanceId]=!0,this.next({isClicked:!0})}},_onBehaviorGotoPrevious:function(t){t.preventDefault();var e=this.seq;if(e>0){if(t.originalEvent&&t.originalEvent[r.inputs.events.handled+this.instanceId])return;t.originalEvent[r.inputs.events.handled+this.instanceId]=!0,this.previous({isClicked:!0})}},_onBehaviorGotoFirst:function(t){t.preventDefault(),t.originalEvent&&t.originalEvent[r.inputs.events.handled+this.instanceId]||(t.originalEvent[r.inputs.events.handled+this.instanceId]=!0,this.show({step:0,isClicked:!0}))},_onBehaviorGotoLast:function(t){t.preventDefault(),t.originalEvent&&t.originalEvent[r.inputs.events.handled+this.instanceId]||(t.originalEvent[r.inputs.events.handled+this.instanceId]=!0,this.show({step:this.maxseq,isClicked:!0}))},_getSteps:function(){return this.stepsWrap.children(".ixp-component-flow-step")},_updateSteps:function(){this.stepsWrap=this.$el.children(".ixp-component-flow-steps").first();var t=this._getSteps();this.maxseq=t.length},_shouldShowProgress:function(){var t=this.$el.attr("class")||"";if(!t)return!1;if(t.indexOf("ixp-c-flow-style-brand-")>-1)return!0;for(var e=["ixp-component-flow-default","ixp-component-flow-dots-light-solid","ixp-component-flow-dots-light","ixp-component-flow-dots-dark-solid","ixp-component-flow-dots-dark","ixp-component-flow-bar-light","ixp-component-flow-bar-dark"],i=0,s=e.length;i<s;i++)if(this.$el.hasClass(e[i]))return!0;return!1},_updateProgress:function(){var t=!this.inEditMode&&this.navigation_enabled,i="none";this._shouldShowProgress()&&(i=t?"clickable":"display");var s="click"+this.eventNamespace;this.$el.off(s,this.progressSelector),l.updateProgress(i,this.maxseq,this.instanceId,this.$el),t&&this.$el.on(s,this.progressSelector,e.bind(this._onProgressClick,this))},_updateControls:function(){var t="click"+this.eventNamespace,i=this.$el.attr("class")||"";return this.inEditMode||!i||i.indexOf("ixp-c-flow-style-brand-")===-1&&i.indexOf("ixp-component-flow-controls-")===-1?void(this.inStudio&&(this.$el.off(t,this.previousSelector),this.$el.off(t,this.nextSelector),l.updateControls(0,this.instanceId,this.$el))):(this.$el.off(t,this.previousSelector),this.$el.off(t,this.nextSelector),l.updateControls(this.maxseq,this.instanceId,this.$el),this.$el.on(t,this.previousSelector,e.bind(this._onClickGotoPrevious,this)),void this.$el.on(t,this.nextSelector,e.bind(this._onClickGotoNext,this)))},_updateHeight:function(){var t=this.$("body"),e=t.scrollTop(),i=this._getActiveHeight();this.inEditMode?this.stepsWrap.css("height","auto"):(this.stepsWrap.css("height",i+"px"),t.scrollTop(e)),this.activeHeight!==i&&(this.activeHeight=i,this.inStudio&&this.studioApp&&this.studioApp.componentsManager.trigger("rmw:reflowed",{instanceId:this.instanceId}))},_getActiveHeight:function(){var t=0,e=this._getSteps(),i=e.length-1;if(this.seq>i?this.seq=i:this.seq<0&&(this.seq=0),this.fixed_height){var s=this;e.each(function(){var e=s.$(this).outerHeight();e>t&&(t=e)})}else this.seq>=0&&this.seq<e.length&&(t=this.$(e[this.seq]).outerHeight());return 0===t&&this.activeHeight&&this.activeHeight>0&&(t=this.activeHeight),t},_createElementBadgeUi:function(t){this.elementBadgeUi=t.append(r.templates.badgeUi).toggle(!this.inEditMode);var e=this;t.find('[data-ixp-flow-action="nextStep"]').on("click",function(t){e._onBehaviorGotoNext(t)}),t.find('[data-ixp-flow-action="prevStep"]').on("click",function(t){e._onBehaviorGotoPrevious(t)})},_toggleElementBadgeUi:function(t){this.elementBadgeUi&&this.elementBadgeUi.toggle(t)},allowedDropTargets:function(){return["Container","Column"]},allowedChildrenTypes:function(){return["ixp-flow-step"]},onGetCommandMap:function(){var t={};return t[r.extensibility.commands.navigate]={fn:this._onCommandNavigate},t[r.extensibility.commands.scrollto]={fn:this._onCommandScrollTo},t},_isOwnStep:function(t){if(!t.is(".ixp-component-flow-step"))return!1;var e=t.closest(".ixp-component-flow-steps"),i=e.attr("data-ixp-flow-steps");return i===this.instanceId},_getOwnStepFromElement:function(t){if(this._isOwnStep(t))return t;var e=t.parent().closest(".ixp-component-flow-step");if(e.length)return this._getOwnStepFromElement(e)},_onCommandScrollTo:function(e){if(t.log("_onCommandScrollTo called on",this,e),e){this._resolveScrollTo("aborted");var i,s,n=!0;if(e.element||e.anchor){var o;if(o=e.element?this.$el.find(e.element):this.$el.find('[data-ixp-anchor="'+e.anchor+'"]'),o.length){if(s=o,this._isOwnStep(o)||(n=!1,s=this._getOwnStepFromElement(o)),!s||!s.length)return;i=this.$.inArray(s.attr("id"),s.parent().children(".ixp-component-flow-step").map(function(){return this.id}))}}else{if(!e.step)return;i=e.step}this.scrollToDeferred={preventScrollToStep:!0};var a=this,r=new Promise(function(t,e){a.scrollToDeferred.resolve=t,a.scrollToDeferred.reject=e}),l={step:i,status:"pending",promise:r,preventDefault:!1};n&&(l.element=this.$el[0],this.change_scroll_top?l.inViewport={tolerance:1,edge:"top"}:l.inViewport={tolerance:.5}),this.scrollToDeferred.envelope=this.getExtensibilityEnvelope(l),this.seq===i&&this._resolveScrollTo("completed"),this.show({step:i}),this.triggerExtensibility(null,l,{done:e.done})}},_resolveScrollTo:function(t){this.scrollToDeferred&&(this.scrollToDeferred.envelope.status=t,this.scrollToDeferred.resolve(this.scrollToDeferred.envelope),this.scrollToDeferred=void 0)},_onCommandNavigate:function(t){this.show({step:t.step})},getParamMapOverrides:function(){return{fixed_height:function(t){this.fixed_height="true"===t,this._onResize()},looping_enabled:function(t){this.looping_enabled=t,this.$el.removeClass("ixp-component-flow-no-looping",!this.looping_enabled)}}},onGetScaffolding:function(t,e,i){return l.getFlowScaffolding(t,e,i)},onGetCssClassesToPreserve:function(){return["!"+r.initClass]},onStudioStateChanged:function(){var t=this.studioApp.state;"hidden"===t.pagePlaceholders?(this.$el.attr(r.modes.modeAttr,r.modes.normalMode),this.inEditMode&&(this.inEditMode=!1,this._updateHeight(),this._updateControls(),this._toggleElementBadgeUi(!0))):(this.$el.attr(r.modes.modeAttr,r.modes.editMode),this.inEditMode||(this.inEditMode=!0,this._updateHeight(),this._updateControls(),this._toggleElementBadgeUi(!1)))},onListenToStudioEvents:function(t){this.onStudioStateChanged(),t.on("page:reflowed",function(t){t&&t.source&&t.source.id===this.instanceId&&t.source.element&&t.source.element&&this.$(t.source.element).hasClass(r.initClass)&&(this.showInit=!1),t&&t.instanceId===this.instanceId||(this._updateSteps(),this._updateProgress(),this._updateControls(),this.show({step:this.seq,force:!0}))},this),t.on("element:badge:activated",function(t){t.instanceId===this.instanceId&&this._createElementBadgeUi(t.$badgeExtensibility)},this)}}),t.components.register("ixp-flow-step",{initialize:function(t){var e=this.$el.closest(r.flowSelector);this.flowInstanceId=e.attr(r.components.data.componentRoot)},onDocumentReady:function(){return this.$el.on("resize"+this.eventNamespace,e.bind(this._onResize,this)),!0},_onResize:function(){t.events.trigger(this.flowInstanceId+r.step.events.resized,{instanceId:this.instanceId})},getParamMapOverrides:function(){return{step_tag:function(t){t&&this.$el.attr("data-ixp-component-tag",t)},step_navigation_tooltip:function(t){t&&this.$el.attr("data-ixp-component-flow-step-tooltip",t)}}},disallowedChildrenTypes:function(){return["ixp-flow-step"]},allowedDropTargets:function(){return["ixp-flow"]},onGetScaffolding:function(t,e,i){return l.getStepScaffolding(t,e,i)}})}(window.ixp.runtime);
//# sourceMappingURL=ixp-flow.min.js.map
